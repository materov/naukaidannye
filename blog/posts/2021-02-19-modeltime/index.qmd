---
title: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤"
subtitle: "–û–±–∑–æ—Ä —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π modeltime, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–π –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤"
author: "–ï.–ù. –ú–∞—Ç–µ—Ä–æ–≤"
date: "2021-01-09"
date-modified: "2024-03-04"
categories: [modeltime, timeseries, Rstats]
image: "modeltime.jpeg"
csl: "../../../gost-r-7-0-5-2008-numeric.csl"
lang: ru

filters:
  - social-share

share:
  permalink: "https://naukaidannye.netlify.app/"
  description: "–∫–ª–∞—Å—Å–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è"
  twitter: true
  email: true
  telegram: true
  mastodon: true

format:
  html:
    toc: true
    toc-depth: 2
    number-sections: false
    toc-location: left

citation: 
  url: https://www.naukaidannye.netlify.app/blog/posts/2021-01-09-modeltime
  citation-key: Materov-modeltime
  issued: "2021-01-09"
  language: ru
---

{{< li qvyppzqz trigger=loop speed=0.9 delay=1000 >}}

–ü–æ–¥ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ä—è–¥–æ–º (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ä—è–¥–æ–º) –æ–±—ã—á–Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–π {$y_t$}, —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ (–æ–±—ã—á–Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ) –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ $t$. –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –æ—á–µ–Ω—å –æ–±—à–∏—Ä–Ω–∞, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å–µ–π—Å–º–æ–ª–æ–≥–∏–∏, –º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏–∏, —ç–∫–æ–Ω–æ–º–∏–∫–µ, –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –ª—é–±—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤. –í—Ä–µ–º–µ–Ω–Ω—ã–º —Ä—è–¥–∞–º –ø–æ—Å–≤—è—â–µ–Ω–æ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, —Ä–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä—è–¥–∞–º–∏ –≤ —Å—Ä–µ–¥–µ **R** –æ–ø–∏—Å–∞–Ω–∞ –≤ –º–æ–Ω–æ–≥—Ä–∞—Ñ–∏—è—Ö [[R.H. Shumway & D.S. Stoffer](https://www.stat.pitt.edu/stoffer/tsa4/){target="_blank"}], [[R. Hyndman and G. Athanasopoulos](https://otexts.com/fpp3/){target="_blank"}] –∏ [[–°.–≠. –ú–∞—Å—Ç–∏—Ü–∫–∏–π](https://ranalytics.github.io/tsa-with-r/){target="_blank"}]. 

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∂–∞—Ä–æ–≤, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—ã—Ö –≤ —Å—É—Ç–∫–∏/–Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü, —É—Ä–æ–≤–µ–Ω—å –≤–æ–¥—ã –≤ –≤–æ–¥–æ–µ–º–∞—Ö, –¥–Ω–µ–≤–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–∑–¥—É—Ö–∞, –∏ —Ç.–¥. –ú—ã –ø–æ–∫–∞–∂–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `modeltime` –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è;
- –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞;
- —Ä–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ;
- –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–µ–π.

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `modeltime` (—Å–º. [—Å–∞–π—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](https://business-science.github.io/modeltime/){target="_blank"} –∏ [–≤–≤–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ](https://www.youtube.com/watch?v=-bCelif-ENY&ab_channel=BusinessScience){target="_blank"}) –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π `tidymodels`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –µ–µ –≤ —Ä–∞–º–∫–∞—Ö –µ–¥–∏–Ω–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö *tidy data* (—Å–º. [[H. Wickham](https://vita.had.co.nz/papers/tidy-data.html){target="_blank"}]). –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ `tidymodels` –º–æ–∂–Ω–æ –Ω–∞ [—Å–∞–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](https://www.tidymodels.org/){target="_blank"} –∏ –∏–∑ –∫–Ω–∏–≥–∏ [[M. Kuhn and J. Silge](https://www.tmwr.org/){target="_blank"}]. 

# –†–∞–±–æ—Ç–∞ —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π modeltime

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

–°—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [CRAN](https://cran.r-project.org/web/packages/modeltime/index.html){target="_blank"}
—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:
```{.r}
install.packages("modeltime")
```
–î–µ–≤–µ–ª–æ–ø–µ—Ä—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ [GitHub](https://business-science.github.io/modeltime/){target="_blank"}:
```{.r}
remotes::install_github("business-science/modeltime")
```

# –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü–æ–¥–∫–ª—é—á–∏–º –Ω–µ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

```{r}
#| warning: false
#| message: false

# –æ–±—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
library(magrittr)
library(tidyverse)
library(lubridate)

# –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
library(tidymodels)
library(modeltime)
library(timetk)

# future! üöÄ
library(future)
plan(sequential)
```

```{r}
#| warning: false
#| message: false
#| echo: false

temp_raw <- readr::read_csv("/Users/materov/@–¥–∞–Ω–Ω—ã–µ/@–±–ª–æ–≥_naukaidannye/2021-02-19-modeltime/t_avg_KRSK.csv")

temp_KRSK <- temp_raw |>
  mutate(year = lubridate::year(date)) |>
  dplyr::filter(year <= 2014) |>
  dplyr::select(date, t_avg)
```

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ñ–æ–Ω–¥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–µ —Å–æ–±–æ–π —Å—Ä–µ–¥–Ω—é—é —Å—É—Ç–æ—á–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–∑–¥—É—Ö–∞ –≤ –≥. –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–µ {{< wi wi-day-sunny >}}. –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç `r format(nrow(temp_KRSK), big.mark = " ")` –∑–∞–ø–∏—Å–µ–π –∏ –∏–º–µ—é—Ç –¥–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: `date` –∏ `t_avg`, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –¥–∞—Ç—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∏ —Å—Ä–µ–¥–Ω—é—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–∑–¥—É—Ö–∞.

```{r}
#| warning: false
#| message: false

temp_KRSK
```

–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–º –≤–æ–∑–¥—É—Ö–∞.

```{r}
#| warning: false
#| message: false
#| fig-width: 7.2
#| fig-height: 3.2
#| code-overflow: wrap
#| fig-cap: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–º –≤–æ–∑–¥—É—Ö–∞ –≤ –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–µ –∑–∞ 2010-2014 –≥–≥.
#| label: fig-source-ts
#| code-fold: true

temp_KRSK |>
  mutate(year = lubridate::year(date)) |>
  dplyr::filter(year <= 2014) |>
  ggplot(aes(x = date, y = t_avg, color = t_avg)) + 
  geom_point(alpha = 0.5) + 
  geom_line(alpha = 0.8) +
  scale_x_date(date_breaks = "1 year",
               date_labels = "%Y") +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) + 
  viridis::scale_color_viridis(option = "plasma") +
  theme_classic(base_size = 14) +
  theme(legend.position = "none") +
  theme(plot.margin = ggplot2::margin(0.01, 0.01, 0.01, 0.01, "cm"))
```

–ò–∑ –≥—Ä–∞—Ñ–∏–∫–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –°–æ—Å—Ç–∞–≤–∏–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ –∏ –∏—Å—Å–ª–µ–¥—É–µ–º –µ–≥–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏.

```{r}
#| warning: false
#| message: false
#| code-fold: true
#| code-overflow: wrap
library(feasts)
library(tsibble)

(temp_ts <- as_tsibble(temp_KRSK, index = date))
```
–ü–æ—Å—Ç—Ä–æ–∏–º —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è –∞–¥–¥–∏—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å, –∫–∞–∫ [STL-—Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ](https://ranalytics.github.io/tsa-with-r/ch-visualisation.html){target="_blank"} –¥–ª—è –æ–¥–Ω–æ–≥–æ–¥–∏—á–Ω–æ–≥–æ –æ–∫–Ω–∞. 

```{r}
#| warning: false
#| message: false
#| code-overflow: wrap

dcmp <- temp_ts |>
  model(STL(t_avg ~ trend(window = 365)))
```

```{.r}
components(dcmp)
```

::: {.small}
```{r}
#| warning: false
#| message: false
#| echo: false

components(dcmp)
```
:::

–ò–∑–æ–±—Ä–∞–∑–∏–º –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.

```{.r}
components(dcmp) |> 
  autoplot() +
  scale_x_date(date_breaks = "1 year",
               date_labels = "%Y") +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) +
  theme_minimal()
```

```{r}
#| warning: false
#| message: false
#| code-overflow: wrap
#| echo: false
#| fig-width: 8
#| fig-height: 7
#| fig-cap: –†–∞–∑–ª–æ–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
#| label: fig-ts-decomposition

components(dcmp) |> 
  autoplot() +
  scale_x_date(date_breaks = "1 year",
               date_labels = "%Y") +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) +
  theme_minimal(base_size = 14) +
  theme(plot.margin = 
    ggplot2::margin(0.01, 0.01, 0.01, 0.01, "cm"))
```  

# –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

–í–µ—Å—å –ø–æ—Ç–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `modeltime` –º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

1.	–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏—Ö –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏.
2.	–°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ–Ω–∫—É **–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
3.	–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–æ–≥–Ω–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –≤ *—Ç–∞–±–ª–∏—Ü—É –º–æ–¥–µ–ª–µ–π*.
4.	–ö–∞–ª–∏–±—Ä–æ–≤–∫—É –º–æ–¥–µ–ª–µ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ.
5.	–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏ –æ—Ü–µ–Ω–∫—É —Ç–æ—á–Ω–æ—Å—Ç–∏.
6.	*–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –º–æ–¥–µ–ª–µ–π* –Ω–∞ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±—É–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.

–ö—Ä–∞—Ç–∫–æ –ø–æ–∫–∞–∂–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–∏—Ö —à–∞–≥–æ–≤. –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω–∞ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω–∞—è –Ω–∞ [—Å–∞–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](https://business-science.github.io/modeltime/articles/getting-started-with-modeltime.html){target="_blank"}.

::: {#fig-modeltime-workflow}

![](modeltime_workflow.jpeg){.lightbox}

–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞

:::

## –®–∞–≥ 1

–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫—É –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ª–∏–±–æ —É–∫–∞–∑–∞–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –ª–∏–±–æ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è.

```{r}
#| warning: false
#| message: false
#| code-overflow: wrap

# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é

set.seed(2024)
splits <- temp_KRSK |>
  arrange(date) |>
  time_series_split(assess     = "6 months",
                    cumulative = TRUE)

# –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
# –≤ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ 90% / 10%
# splits <- temp_KRSK |>
#   arrange(date) |>
#   rsample::initial_time_split(prop = 0.9)

splits
```


```{r}
#| warning: false
#| message: false
#| code-overflow: wrap
#| code-fold: true
#| fig-width: 8
#| fig-height: 4.5
#| fig-cap: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫—É
#| label: fig-ts-split

splits |>
  tk_time_series_cv_plan() |>
  plot_time_series_cv_plan(date, t_avg, 
                           .interactive = FALSE) +
  scale_x_date(date_breaks = "12 months",
               date_labels = "%Y") +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) +
  labs(title = "–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫—É",
       subtitle = "–≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤",
       color = "–í—ã–±–æ—Ä–∫–∞:") +
  theme_bw(base_size = 14) +
  theme(plot.margin = ggplot2::margin(0.01, 0.01, 0.01, 0.01, "cm"), 
        legend.position = "bottom")
```

## –®–∞–≥ 2

–°–ª–µ–¥—É—é—â–∏–º —ç—Ç–∞–ø–æ–º —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π. –ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å `modeltime` –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ *—Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ*. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –º–æ–¥–µ–ª–∏, –≤—ã–±–∏—Ä–∞—è –Ω–∞–∏–ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –≤–∫–ª—é—á–∞—è –∫–∞–∫ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏

- Linear Regression
- ARIMA
- Exponential Smoothing
- MARS (Multivariate Adaptive Regression Splines)

—Ç–∞–∫ –∏ –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –ú–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã, —á–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏, —ç—Ç–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç *—Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞* -- `workflows` (–∏–Ω–æ–≥–¥–∞ –Ω–∞–∑—ã–≤–∞–µ–º–æ–≥–æ *–∫–æ–Ω–≤–µ–π–µ—Ä–æ–º*). –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞ —Å–∞–π—Ç–µ [Modeltime Ecosystem Roadmap: New Algorithms & Models](https://github.com/business-science/modeltime/issues/5){target="_blank"}. –û—Ç–º–µ—Ç–∏–º, —á—Ç–æ `modeltime` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã, —É–ª—É—á—à–∞—è –∏—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—É—á–∞—è *Boosted Models* –Ω–∞ –æ—Å–Ω–æ–≤–µ *CatBoost* –∏–ª–∏ *LightGBM*.

–û–±—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Ç–µ–∫–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

-	–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–∞ –º–æ–¥–µ–ª–∏, —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–≥–æ **—Ä–µ—Ü–µ–ø—Ç–∞** (recipe) –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—è `tidymodels`.
-	–°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π –º–æ–¥–µ–ª–∏.
-	–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π –º–æ–¥–µ–ª–∏, –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–π –º–æ–¥–µ–ª–∏.

–ü–æ—Å—Ç—Ä–æ–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞.

### 1. –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è

```{r}
# –ú–æ–¥–µ–ª—å 1: lm
# –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è
model_fit_lm <- linear_reg() |>
  set_engine("lm") |>
  fit(t_avg ~ as.numeric(date) + factor(month(date), ordered = FALSE),
      data = training(splits))
```

```{.r}
model_fit_lm
```

:::{.smaller .column-page-inset-right}

```{r}
#| message: false
#| warning: false
#| echo: false

model_fit_lm
```

:::

### 2. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å ARIMA —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```{r}
# –ú–æ–¥–µ–ª—å 2: auto_arima
# ARIMA
model_fit_arima <- arima_reg() |>
  set_engine(engine = "auto_arima") |>
  fit(t_avg ~ date, data = training(splits))
```

```{.r}
model_fit_arima
```

```{r}
#| message: false
#| warning: false
#| echo: false

model_fit_arima
```

### 3. –ú–æ–¥–µ–ª—å ARIMA Boost

```{r}
# –ú–æ–¥–µ–ª—å 3: arima_boost
# ARIMA —Å –±—É—Å—Ç–∏–Ω–≥–æ–º (—É–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å –ø–æ–º–æ—â—å—é XGBoost)
model_fit_arima_boosted <- arima_boost(
  min_n = 2,
  learn_rate = 0.015) |>
  set_engine(engine = "auto_arima_xgboost") |>
  fit(t_avg ~ date + as.numeric(date) + 
        factor(month(date), ordered = F),
      data = training(splits))
```      

### 4. –ú–æ–¥–µ–ª—å ETS

```{r}
# –ú–æ–¥–µ–ª—å 4: ets
# —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
# ETS(A,N,N)
model_fit_ets <- exp_smoothing() |>
  set_engine(engine = "ets") |>
  fit(t_avg ~ date, data = training(splits))
```

```{r}
model_fit_ets
```

### 5. –ú–æ–¥–µ–ª—å Prophet

```{r}
#| message: false
#| warning: false

# –ú–æ–¥–µ–ª—å 5: prophet
# Prophet by Facebook
model_fit_prophet <- prophet_reg() |>
  set_engine("prophet") |>
  fit(t_avg ~ date, training(splits))
```

```{r}
model_fit_prophet
```

### 6. –ú–æ–¥–µ–ª—å MARS

```{r}
# –ú–æ–¥–µ–ª—å 6: MARS
# –ü—Ä–∏–º–µ—Ä "—Ä–µ—Ü–µ–ø—Ç–∞" –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏
recipe_spec <- recipe(t_avg ~ date, data = training(splits)) |>
  step_date(date, features = "month", ordinal = FALSE) |>
  step_mutate(date_num = as.numeric(date)) |>
  step_normalize(date_num) |>
  step_rm(date)
```

```{r}
# –≤–∏–¥ "—Ä–µ—Ü–µ–ø—Ç–∞"
recipe_spec |> prep() |> juice()
```

```{r}
# —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ MARS (Computational engine: earth)
model_spec_mars <- mars(mode = "regression") |>
  set_engine("earth")
```

```{r}
#| message: false
#| warning: false

# —Å–æ–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å MARS
workflow_fit_mars <- workflow() |>
  add_recipe(recipe_spec) |>
  add_model(model_spec_mars) |>
  fit(training(splits))
```  

```{.r}
workflow_fit_mars
```

:::{.smaller .column-page-inset-right}

```{r}
#| echo: false
#| warning: false
#| message: false
workflow_fit_mars
```

:::

### 7. –ú–æ–¥–µ–ª—å Prophet Boost

```{r}
# –ú–æ–¥–µ–ª—å 7: Prophet Boost
# —Ä–µ—Ü–µ–ø—Ç
recipe_spec <- recipe(t_avg ~ date, training(splits)) |>
  step_timeseries_signature(date) |>
  step_rm(contains("am.pm"), contains("hour"), contains("minute"),
          contains("second"), contains("xts")) |>
  step_fourier(date, period = 365, K = 5) |>
  step_dummy(all_nominal())
```

```{r}
# —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
model_spec_prophet_boost <- prophet_boost() |>
  set_engine("prophet_xgboost", 
             yearly.seasonality = TRUE)
```

```{r}
#| message: false
#| warning: false

# —Å–±–æ—Ä–∫–∞ –º–æ–¥–µ–ª–∏
workflow_fit_prophet_boost <- workflow() |>
  add_model(model_spec_prophet_boost) |>
  add_recipe(recipe_spec) |>
  fit(training(splits))
```  

### 8. –ú–æ–¥–µ–ª—å glmnet

```{r}
# –ú–æ–¥–µ–ª—å 8: glmnet
# recipe
recipe_spec <- recipe(t_avg ~ date, training(splits)) |>
  step_timeseries_signature(date) |>
  step_rm(contains("am.pm"), contains("hour"), contains("minute"),
          contains("second"), contains("xts")) |>
  step_fourier(date, period = 365, K = 5) |>
  step_dummy(all_nominal())
```

```{.r}
# –ø—Ä–æ—Å–º–æ—Ç—Ä "—Ä–µ—Ü–µ–ø—Ç–∞"
recipe_spec |> prep() |> juice()
```

:::{.smaller .column-page-inset-right}
```{r}
#| echo: false
#| message: false
#| warning: false

recipe_spec |> prep() |> juice()
```
:::

```{r}
# —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
model_spec_glmnet <- linear_reg(penalty = 0.01, mixture = 0.5) |>
  set_engine("glmnet")
```

```{r}
# —Å–±–æ—Ä–∫–∞ –º–æ–¥–µ–ª–∏ glmnet
workflow_fit_glmnet <- workflow() |>
  add_model(model_spec_glmnet) |>
  add_recipe(recipe_spec %>% step_rm(date)) |>
  fit(training(splits))
```

### 9. –ú–æ–¥–µ–ª—å XGBoost

```{r}
recipe_ml_xb <- recipe(t_avg ~ date, training(splits)) |>
  step_timeseries_signature(date) |>
  step_rm(date) |>
  step_dummy(all_nominal_predictors(), one_hot = TRUE)
```

```{r}
model_xgb <- boost_tree("regression") |>
  set_engine("xgboost")
```

```{r}
# —Å–±–æ—Ä–∫–∞ –º–æ–¥–µ–ª–∏ XGBoost
workflow_fit_xgb <- workflow() |>
  add_model(model_xgb) |>
  add_recipe(recipe_ml_xb) |>
  fit(training(splits))
```

## –®–∞–≥ 3

–ú–æ–¥–µ–ª–∏ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –µ–¥–∏–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –º–æ–¥–µ–ª–µ–π, –≤ –∫–æ—Ç–æ—Ä–æ–π –¥–æ –≤–∫–ª—é—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞ –∑–∞—Ç–µ–º –ø—Ä–æ—Ö–æ–¥–∏—Ç –∏—Ö –ø–æ–¥–≥–æ–Ω–∫–∞/–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ. –î–∞–ª–µ–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏:

- **MAE** ‚Äì —Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞;
- **MAPE** ‚Äì —Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è –æ—à–∏–±–∫–∞;
- **MASE** ‚Äì —Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞;
- **SMAPE** ‚Äì —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è —Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è –æ—à–∏–±–∫–∞;
- **RMSE** ‚Äì —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞;
- **RSQ** ‚Äì –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å $R^2$.

```{r}
# –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–æ–≥–Ω–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü—ã –º–æ–¥–µ–ª–µ–π
models_tbl <- modeltime_table(
  model_fit_lm,
  model_fit_arima,
  model_fit_arima_boosted,
  model_fit_ets,
  model_fit_prophet,
  # –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
  workflow_fit_mars,
  workflow_fit_prophet_boost,
  workflow_fit_glmnet,
  workflow_fit_xgb
)
```

```{r}
# –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã –º–æ–¥–µ–ª–µ–π
models_tbl
```

## –®–∞–≥ 4

–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞, –ø–æ —Å—É—Ç–∏, -- —ç—Ç–æ —Å–ø–æ—Å–æ–± –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ —Ç–æ—á–Ω–æ—Å—Ç–∏, –ø—Ä–∏ —ç—Ç–æ–º –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -- —ç—Ç–æ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –Ω–µ–≤—è–∑–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –≤–Ω–µ –≤—ã–±–æ—Ä–∫–∏.

```{r}
# –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
calibration_tbl <- models_tbl |>
  modeltime_calibrate(new_data = testing(splits))
```

```{.r}
# —Ç–∞–±–ª–∏—Ü–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
# –¥–æ–±–∞–≤–∏–ª–∏—Å—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ .type –∏ .calibration_data
calibration_tbl
```

:::{style="font-size: 95%;"}

```{r}
#| warning: false
#| message: false
#| echo: false
calibration_tbl
```

:::

## –®–∞–≥ 5

–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è.

```{r}
#| warning: false
#| message: false
#| code-fold: true
#| fig-width: 7.8
#| label: fig-forecast-to-testing
#| fig-cap: –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫—É
# –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫—É

calibration_tbl |>
  modeltime_forecast(new_data    = testing(splits), 
                     actual_data = temp_KRSK) |> 
  dplyr::filter(.index >= "2013-01-01") |> 
  plot_modeltime_forecast(.interactive = F) +
  labs(color = "",
       title = "–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫—É") + 
  scale_x_date(date_labels = "%b %Y") +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) +
  guides(color = guide_legend(ncol = 2)) +
  theme_bw(base_size = 14) +
  theme(plot.margin = ggplot2::margin(0.01, 0.01, 0.01, 0.01, "cm"), 
        legend.position = "bottom")
```

–¢–∞–∫–∂–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ –æ—à–∏–±–æ–∫, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤—ã—à–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏, –ø—Ä–∏–º–µ—Ä —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–∫–∞–∑–∞–Ω –Ω–∏–∂–µ.

```{r}
#| warning: false
#| message: false
# —Ç–∞–±–ª–∏—Ü–∞ –æ—à–∏–±–æ–∫
calibration_tbl |>
  modeltime_accuracy() |>
  table_modeltime_accuracy(.interactive = F) 
```

## –®–∞–≥ 6

–ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏—Ç—å –∏—Ö –Ω–∞ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å –±—É–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.

::: {.callout-note appearance="simple"}
–ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞, –Ω–µ –≤—Å–µ –º–æ–¥–µ–ª–∏ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∏–º–µ—é—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ä–æ—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –æ—à–∏–±–æ–∫ (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–ª–∏–∑–æ–∫ –∫ –µ–¥–∏–Ω–∏—Ü–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ), –º–æ–¥–µ–ª–∏ —Å 1 –ø–æ 4 –∏ 6 –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–∑-–∑–∞ –Ω–∏–∑–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏.
:::

```{r}
#| warning: false
#| message: false
'%not_in%' <- function(x,y)!('%in%'(x,y))

refit_tbl <- calibration_tbl |>
  filter(.model_id %not_in% c(1:4, 6)) |>
  modeltime_refit(data = temp_KRSK)
```

–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 1 –≥–æ–¥ –≤–ø–µ—Ä–µ–¥, –∏–∑–æ–±—Ä–∞–∑–∏–≤ –ø—Ä–∏ —ç—Ç–æ–º –∏ –∏—Å—Ç–∏–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

```{r}
#| code-overflow: wrap
#| warning: false
#| message: false
# –∏—Å—Ç–∏–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å 1 —è–Ω–≤–∞—Ä—è –ø–æ 31 –¥–µ–∫–∞–±—Ä—è 2015 –≥–æ–¥–∞
temp_2015 <- temp_raw |>
  dplyr::filter(between(date, as.Date("2015-01-01"), 
                              as.Date("2015-12-31"))) |>
  rename(.index = date)
```

```{r}
temp_2015
```

```{r}
#| message: false
#| warning: false
#| fig-width: 7.8
#| code-fold: true
#| code-overflow: wrap
#| label: fig-final-forecast
#| fig-cap: –ü—Ä–æ–≥–Ω–æ–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π

refit_tbl |>
  modeltime_forecast(h = "1 year", 
                     actual_data = temp_KRSK) |>
  dplyr::filter(.index >= "2014-01-01") |>
  plot_modeltime_forecast(.interactive = FALSE,
                          .conf_interval_fill = "grey50") +
  geom_line(data = temp_2015, aes(x = .index, y = t_avg), 
             color = "grey30", linewidth = 0.5) +
  labs(title    = "–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π",
       subtitle = "–ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 1 –≥–æ–¥ –≤–ø–µ—Ä–µ–¥",
       color    = "–ú–æ–¥–µ–ª–∏:") + 
  scale_x_date(#date_breaks = "1 year",
               date_labels = "%b %Y") +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) + 
  ggsci::scale_color_jama() +
  theme_bw(base_size = 14) +
  guides(color = guide_legend(ncol = 2,
                              override.aes = list(size = 7))) +
  theme(plot.margin = ggplot2::margin(0.01, 0.01, 0.01, 0.01, "cm"),
        legend.position = "bottom")
```

–ú—ã –≤–∏–¥–∏–º, —á—Ç–æ –º–æ–¥–µ–ª–∏ **PROPHET** –∏ **GLMNET** –¥–∞—é—Ç –±–ª–∏–∑–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ —Ç—Ä–µ–Ω–¥–µ, –∞ **PROPHET W/ XGBOOST ERRORS** –∏ **XGBOOST** –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏, –ø—Ä–∏—á–µ–º **PROPHET W/ XGBOOST ERRORS** –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –∑–Ω–∞—á–µ–Ω–∏–π. –£ –Ω–∞—Å –∏–º–µ—é—Ç—Å—è –∏—Å—Ç–∏–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –∑–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–π 2015 –≥–æ–¥, –∫–∞–∫–∞—è –∂–µ –∏–∑ –º–æ–¥–µ–ª–µ–π –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–∫–æ–π –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º? –°–æ—Å—Ç–∞–≤–∏–º –∞–Ω–∞–ª–æ–≥ –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

```{r}
#| code-overflow: wrap
#| warning: false
#| message: false

# –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ –∏—Å—Ç–∏–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º?
# –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–Ω—å—à–µ -- –ª—É—á—à–µ
refit_tbl |>
  modeltime_forecast(h = "1 year", 
                     actual_data = temp_KRSK) |>
  dplyr::filter(.index >= "2015-01-01",
                .index <= "2015-12-31",
                .key == "prediction") %>% 
  left_join(., temp_2015) |>
  group_by(.model_desc) |>
  summarise(model_variance = sum(.value - t_avg)^2 / 10000)
```

–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, —á—Ç–æ **PROPHET** –æ–∫–∞–∑–∞–ª–∞—Å—å –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–º.

# –ö–æ–Ω—Ñ–æ—Ä–º–Ω–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–æ–Ω—Ñ–æ—Ä–º–Ω–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ) —Å–ª—É–∂–∏—Ç –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –≤—Ö–æ–¥–∏—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∞—É–∫–æ–π –æ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞—à–∏–Ω–Ω—ã–º –æ–±—É—á–µ–Ω–∏–µ–º. –ò—Å—Ç–æ—Ä–∏—è –∏ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ –º–µ—Ç–æ–¥ —Ö–æ—Ä–æ—à–æ –∏–∑–ª–æ–∂–µ–Ω—ã –≤ —Å—Ç–∞—Ç—å–µ [[A. N. Angelopoulos and S. Bates, 2021](https://arxiv.org/abs/2107.07511){target="_blank"}], –∞ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å—É—Ç—å –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –º–æ–Ω–æ–≥—Ä–∞—Ñ–∏–∏ [[V. Vovk, A. Gammerman, and G. Shafer](https://link.springer.com/book/10.1007/978-3-031-06649-8){target="_blank"}]. –¢–∞–∫–∂–µ, –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ [Awesome Conformal Prediction](https://github.com/valeman/awesome-conformal-prediction){target="_blank"}, –∫–æ—Ç–æ—Ä—É—é –≤–µ–¥–µ—Ç **–í–ª–∞–¥–∏–º–∏—Ä –ú–∞–Ω–æ—Ö–∏–Ω**. –ú—ã –ø—Ä–∏–º–µ–Ω—è–µ–º –º–µ—Ç–æ–¥ –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ (—Å–º. [—Å—Ç–∞—Ç—å—é](https://business-science.github.io/modeltime/articles/modeltime-conformal-prediction.html){target="_blank"} –Ω–∞ —Å–∞–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `modeltime`).

–ù–∞—á–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ —Ç–∞–∫–∏–µ –∂–µ, –∫–∞–∫ –∏ –≤—ã—à–µ, –ø–æ—ç—Ç–æ–º—É –º—ã –≤—ã–±–µ—Ä–µ–º –¥–≤–µ –º–æ–¥–µ–ª–∏ **PROPHET** –∏ **XGBOOST** –¥–ª—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Å—Ç–∞–≤–∏–º —Ç–∞–±–ª–∏—Ü—É –º–æ–¥–µ–ª–µ–π.

```{r}
#| warning: false
#| message: false
models_tbl_conf <- modeltime_table(
  model_fit_prophet,
  workflow_fit_xgb
)
```

–°–¥–µ–ª–∞–µ–º –∫–∞–ª–∏–±—Ä–æ–≤–∫—É –º–æ–¥–µ–ª–µ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ.

```{r}
#| warning: false
#| message: false
calibration_tbl_conf <- models_tbl_conf |>
  modeltime_calibrate(
    new_data = testing(splits)
  )
```

–¢–µ–ø–µ—Ä—å –º—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è –±–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `qnorm()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ 95% —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≥—Ä–∞–Ω–∏—Ü). –ú–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ (–≥–∞—É—Å—Å–æ–≤–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ) –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—à–∏–±–æ–∫ –≤–Ω–µ –≤—ã–±–æ—Ä–∫–∏ (–æ—Å—Ç–∞—Ç–∫–æ–≤). –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é, —Ç.–µ., –µ—Å–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–µ —Ä–∞–≤–Ω–æ –Ω—É–ª—é, –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã —Ä–∞—Å—à–∏—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —É—á–µ—Ç–∞ —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö.

```{r}
#| warning: false
#| message: false
forecast_tbl_conf <- calibration_tbl_conf |>
  modeltime_forecast(
    new_data      = testing(splits),
    actual_data   = temp_KRSK,
    conf_interval = 0.95,
    conf_method   = "conformal_default",
    conf_by_id    = FALSE,
    keep_data     = TRUE
  )
```

:::{style="font-size: 95%;"}

```{r}
forecast_tbl_conf |> tail()
```

:::

–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±–æ–∏—Ö –º–æ–¥–µ–ª–µ–π.

```{r}
#| message: false
#| warning: false
#| fig-width: 7.8
#| code-fold: true
#| code-overflow: wrap
#| label: fig-conformal-prediction
#| fig-cap: –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è

forecast_tbl_conf |>
  dplyr::filter(.index >= "2014-01-01") |>
  plot_modeltime_forecast(
    .interactive = FALSE,
    .conf_interval_fill = "grey50",
    .title = "–ö–æ–Ω—Ñ–æ—Ä–º–Ω–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ"
  ) +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) +
  theme_bw(base_size = 14) +
  labs(color = "–ú–æ–¥–µ–ª–∏:")  +
  guides(color = guide_legend(override.aes = list(size = 7))) +
  theme(plot.margin = ggplot2::margin(0.01, 0.01, 0.01, 0.01, "cm"),
        legend.position = "bottom")
```

–ú–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∏–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –∏ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –±—É–¥—É—â–µ–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏, –ø—Ä–∏–º–µ–Ω–∏–≤ –∫–æ–Ω—Ñ–æ—Ä–º–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∫ –æ—Ü–µ–Ω–∫–∞–º –±—É–¥—É—â–µ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞. –û—Ç–º–µ—Ç–∏–º, —á—Ç–æ –∑–¥–µ—Å—å –∑–Ω–∞—á–µ–Ω–∏–µ `conf_method = "conformal_split"`, —Ç.–∫. —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç *–º–µ—Ç–æ–¥ –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º* (*split conformal prediction*) –∏–ª–∏ *—Å–ø–ª–∏—Ç-–∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ*, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ [[J. Lei, M. G'Sell, A. Rinaldo, R. J. Tibshirani, L. Wasserman, 2016](https://arxiv.org/abs/1604.04173){target="_blank"}], —á—Ç–æ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `int_conformal_split()` –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ **R** [probably](https://probably.tidymodels.org/){target="_blank"}. –î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è—Ö –Ω–∞–±–æ—Ä—ã –∫–æ–Ω—Ñ–æ—Ä–º–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ. –≠—Ç–∏ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∏—Ä—É—é—Ç —Å –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–º–∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∑–∞—Ç—Ä–∞—Ç–∞–º–∏, —á—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –∏—Ö –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ. –ß—Ç–æ–±—ã —Ä–µ—à–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, –±—ã–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –∏–Ω–¥—É–∫—Ç–∏–≤–Ω–æ–µ –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, –Ω–æ –∑–∞ —Å—á–µ—Ç –≤–≤–µ–¥–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –∏–∑-–∑–∞ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

```{r}
#| message: false
#| warning: false

refit_tbl <- calibration_tbl_conf |>
  modeltime_refit(temp_KRSK)

new_data_tbl <- temp_KRSK |>
  future_frame(.length_out = "1 year") 

forecast_future_tbl <- refit_tbl |>
  modeltime_forecast(
    new_data      = new_data_tbl,
    actual_data   = temp_KRSK,
    conf_interval = 0.95,
    conf_method   = "conformal_split",
    conf_by_id    = FALSE,
    keep_data     = TRUE
  )
```

–° –ø–æ–º–æ—â—å—é –ø—Ä–æ–≥–Ω–æ–∑–∞ –Ω–∞ –±—É–¥—É—â–µ–µ –º—ã –º–æ–∂–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —Ç–æ—á–µ—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏, —Ç–∞–∫ –∏ 95%-–æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏. –ö–∞–∫ –≤–∏–¥–Ω–æ, –∏—Å—Ç–∏–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ö–æ–¥—è—Ç –≤ 95%-–ø—Ä–æ–≥–Ω–æ–∑.

```{r}
#| message: false
#| warning: false
#| fig-width: 7.8
#| code-fold: true
#| code-overflow: wrap
#| label: fig-conformal-split
#| fig-cap: –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–µ—Ç–æ–¥–∞ –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º

forecast_future_tbl |>
  dplyr::filter(.index >= "2014-01-01") |>
  plot_modeltime_forecast(
    .interactive = FALSE,
    .title       = "–ú–µ—Ç–æ–¥ –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º"
  ) +
  geom_line(data = temp_2015, aes(x = .index, y = t_avg), 
            color = "grey30", linewidth = 0.5) +
  scale_x_date(date_labels = "%b %Y") +
  scale_y_continuous(labels = function(x) str_c(x, " ¬∞C")) +
  labs(color = "–ú–æ–¥–µ–ª–∏:")  +
  theme_bw(base_size = 14) +
  theme(plot.margin = ggplot2::margin(0.01, 0.01, 0.01, 0.01, "cm"), 
        legend.position = "bottom")
```

# –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤–æ–∑–¥—É—Ö–∞, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ –ø–æ —Å–µ–±–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π –∑–∞–¥–∞—á–µ–π –∏ —Å–ª—É–∂–∏—Ç —Ö–æ—Ä–æ—à–µ–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–µ–π –º–µ—Ç–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è **R**, –º–æ–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –∏ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ª–∞—Ç—å –Ω–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ **R Markdown** –∏ **Shiny** –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤, —á—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º.

:::{.column-margin}

<head>
  <!-- add the button style & script -->
  <link rel="stylesheet" href="../../../dist/applause-button.css" />
  <script src="../../../dist/applause-button.js"></script>
</head>
<body>
  <!-- add the button! -->
  <applause-button style="width: 58px; height: 58px;"/>
</body>

:::

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `modeltime` –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π —Å –ø–æ–º–æ—â—å—é —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã (*Accuracy Table*), —Å–æ–¥–µ—Ä–∂–∞—â–µ–π –º–µ—Ç—Ä–∏–∫–∏, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –¢–∞–∫–∂–µ, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `modeltime` –º–µ—Ç–æ–¥–∞ –∫–æ–Ω—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è. –ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–æ–ø–æ–ª–Ω—è—é—â–∏–µ `modeltime`: [sknifedatar](https://rafzamb.github.io/sknifedatar/index.html){target="_blank"}, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∞–±–æ—Ä–∞–º–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤, [modeltime.h2o](https://business-science.github.io/modeltime.h2o/){target="_blank"} –∫–∞–∫ backend –¥–ª—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã `modeltime` –Ω–∞ –æ—Å–Ω–æ–≤–µ [H2O AutoML](https://h2o.ai/){target="_blank"} –∏ [modeltime.gluonts](https://business-science.github.io/modeltime.gluonts/){target="_blank"} –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ *Deep Learning*.

:::{.callout-tip collapse="true"}
## Session Info
```{r}
#| echo: false

library(sessioninfo)

pkg_sesh <- session_info(pkgs = "attached")

quarto_version <- system("quarto --version", intern = TRUE)

pkg_sesh$platform$quarto <- paste(
  system("quarto --version", intern = TRUE)
  )

pkg_sesh
```

:::